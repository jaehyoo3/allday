<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bluebee.modules.store.StoreMapper">

    <resultMap id="resultMapObj" type="com.bluebee.modules.store.Store"></resultMap>
    
    <select id="selectList" resultMap="resultMapObj">
    <include refid="Base.selectListUpper"/>
	    	select
	    		a.productSeq
	    		,a.productName
	    		,a.productType
	    		,a.productPrice
	    		,a.productNew
	    		,a.productBest
	    		,a.productRegDate
	    		,a.productUpDate
				,b.*
		<include refid='basic' />
		<include refid='Base.selectListLower'/>
    </select>
    <select id="selectDetailImg" resultMap="resultMapObj">
    	select 
    		a.*
    		,b.*
    	from 
    		product a
    	left join
    		productDetailUploaded b
    	on a.productSeq = b.pseq
    	order by b.sort ASC
    </select>
    <!-- 리뷰s -->
    <insert id="reviewInsert">
    	insert into reView(
    	member_memberSeq
    	,product_Seq
    	,Score
    	,Content
    	,reviewDelNy
    	,reviewRegDate
    	) values (
    	#{member_memberSeq}
    	,#{product_Seq}
    	,#{Score}
    	,#{Content}
    	,0
    	,now()
    	)
    	<selectKey resultType="String" keyProperty="reViewSeq" order="AFTER"> 
			select last_insert_id()
		</selectKey>
    </insert>
    <select id="reviewList" resultMap="resultMapObj">
    	select
    		*
    	from reView
    	where 1=1
    		and product_Seq = #{productSeq}
    </select>
    <!-- 리뷰e -->
    <!-- wish s -->
    <insert id="wish">
    	insert into wishList(
    	member_memberSeq
    	,product_Seq
    	,wishListDelNy
    	) values (
    	#{member_memberSeq}
    	,#{product_Seq}
    	,1
    	)	
     	<selectKey resultType="String" keyProperty="wishSeq" order="AFTER"> 
			select last_insert_id()
		</selectKey>
    </insert>
    
	<select id="wishCount" resultType="Integer">
		SELECT
			count(*)
		from wishList
		where 1=1
		and product_Seq = #{productSeq}
	</select>
    <!-- wish e -->
    <insert id="insert">
    	insert into product(
    		productName
    		,productType
    		,productPrice
    		,productNew
    		,productBest
    		,productRegDate
    		,informationType
    		,informationColor
    		,informationSize
    		,informationCompany
    		,informationWarning
    		,informationCountry
    		,informationQuality
    		,informationAS
    		,productDelNy
    		)
    		VALUES(
    		 #{productName}
    		,#{productType}
    		,#{productPrice}
    		,#{productNew}
    		,#{productBest}
    		,now()
    		,#{informationType}
    		,#{informationColor}
    		,#{informationSize}
    		,#{informationCompany}
    		,#{informationWarning}
    		,#{informationCountry}
    		,#{informationQuality}
    		,#{informationAS}
    		,#{productDelNy}
    		)
		<selectKey resultType="String" keyProperty="productSeq" order="AFTER"> 
			select last_insert_id()
		</selectKey>
    </insert>
    
    <insert id="detailinsert">
    	insert into productDetail(
    		product_Seq
    		,color_colorseq
    		,size_size
    		,num
    	)
    	VALUES(
    		#{productSeq}
    		,#{color_colorseq}
    		,#{size_size}
    		,#{num}
    	)
	    <selectKey resultType="String" keyProperty="detailSeq" order="AFTER"> 
			select last_insert_id()
		</selectKey>
    </insert>
    
    <update id="update">
    	update product
    	set
    	    productName = #{productName}
    		,productType = #{productType}
    		,productPrice = #{productPrice}
    		,productNew = #{productNew}
    		,productBest = #{productBest}
    		,productRegDate = #{productRegDate}
    		,informationType = #{informationType}
    		,informationColor = #{informationColor}
    		,informationSize = #{informationSize}
    		,informationCompany = #{informationCompany}
    		,informationCountry = #{informationCountry}
    		,informationWarning = #{informationWarning}
    		,informationQuality = #{informationQuality}
    		,informationAS = #{informationAS}
    		,productDelNy = #{productDelNy}
    		where
			productSeq = #{productSeq}
    
    </update>
    <select id="colorList" resultMap="resultMapObj">
    	select 
    		a.Color_colorSeq
    		,a.detailSeq
    		,c.colorName
    		,c.colorSeq
    	from 
    		productDetail a
    	join 
    		product b
    	on 
    		a.product_Seq = b.productSeq 
    	join
    		Color c
    	on
    		a.Color_colorseq = c.colorSeq
    	where 1=1
			AND b.productSeq = #{productSeq}
			group by c.colorName  		
    </select>
    
     <select id="sizeList" resultMap="resultMapObj">
    	select 
    		a.detailSeq
    		,c.sizeName
    		,a.num
    		,a.Color_colorSeq
    	from 
    		productDetail a
    	join 
    		product b
    	on 
    		a.product_Seq = b.productSeq 
    	join
    		Size c
    	on
    		a.Size_Size= c.Size
    	where 1=1
			AND b.productSeq = #{productSeq}
		order by detailSeq asc
    </select>
    
   <select id="cL" resultMap="resultMapObj">
    	select 
    		colorSeq
        	,colorName
    	from Color
    </select>
    <select id="sL" resultMap="resultMapObj">
    	select 
    		Size
        	,sizeName
    	from Size
    </select>
	<select id="selectOne" resultMap="resultMapObj">
		SELECT
    		a.productSeq
    		,a.productName
    		,a.productType
    		,a.productPrice
    		,a.productNew
    		,a.productBest
    		,a.productRegDate
    		,a.productUpDate
    		,a.informationType
    		,a.informationColor
    		,a.informationSize
    		,a.informationWarning
    		,a.informationCompany
    		,a.informationCountry
    		,a.informationQuality
    		,a.informationAS
    		,a.productDelNy
    	from
    		product a
    	left join
    		wishList b
    	on 
    		a.productSeq = b.product_Seq
    	where 1=1
			and a.productSeq = #{productSeq}
	</select>
		
	<select id="selectOneCount" resultType="Integer">
		SELECT COUNT(*)
		<include refid="basic" />
	</select>
	
    <sql id='basic'>
		FROM 
			product a
		left join
			productUploaded b
		on a.productSeq = b.pseq
		WHERE 1=1
		<choose>
				<when test="shType == 0">AND a.productName LIKE CONCAT('%',#{shValue},'%') </when>
				<when test="shType == 1">AND a.productName LIKE CONCAT('%',#{shValue},'%') AND a.productType = 1</when>
				<when test="shType == 2">AND a.productName LIKE CONCAT('%',#{shValue},'%') AND a.productType = 2</when>
				<when test="shType == 3">AND a.productName LIKE CONCAT('%',#{shValue},'%') AND a.productType = 3</when>
			</choose>
   	</sql>
</mapper>