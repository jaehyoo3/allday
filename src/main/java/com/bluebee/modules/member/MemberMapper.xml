<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bluebee.modules.member.MemberMapper">

    <resultMap id="resultMapObj" type="com.bluebee.modules.member.Member"></resultMap>
	
	<select id="selectList" resultMap="resultMapObj">
	    	<include refid="Base.selectListUpper"/>
		SELECT
			*
		<include refid="basic" />
			ORDER BY memberSeq DESC
		<include refid='Base.selectListLower'/>
	</select>
	
	<insert id="insert">
		insert into member(
		memberID
		,memberPW
		,memberNick
		,memberName
		,memberDob
		,memberGender
		,memberEmail
		,memberMobile
		,memberDelNy
		,memberAd
		,memberGrade
		,memberRegdate
		)
		values(
		#{memberID}
		,#{memberPW}
		,#{memberNick}
		,#{memberName}
		,#{memberDob}
		,#{memberGender}
		,#{memberEmail}
		,#{memberMobile}
		,0
		,#{memberAd}
		,1
		,now()
		)
		<selectKey resultType="String" keyProperty="memberSeq" order="AFTER"> 
			select last_insert_id()
		</selectKey>
	</insert>
	
		<select id="selectOneCount" resultType="Integer">
			SELECT COUNT(*)
			<include refid="basic" />
		</select>

		<update id="update">
		UPDATE member
		SET	
			memberID = #{memberID}
			,memberPW = #{memberPW}
			,memberNick = #{memberNick}
			,memberName = #{memberName}
			,memberDob = #{memberDob}
			,memberEmail = #{memberEmail}
			,memberMobile = #{memberMobile}
			,memberDelNy = 1
			,memberGrade = #{memberGrade}
			,memberGender = #{memberGender} 
		where
			memberSeq = #{memberSeq}
	</update>
	
	<update id="uelete">
		UPDATE 
			member
		SET
			memberDelNy = 1
		WHERE
			memberSeq = #{memberSeq}
		</update>
		
		<delete id="delete">
		delete from 
			member 
		where 
			memberSeq = #{memberSeq}
		</delete>
	<!-- 회원가입 -->
	<insert id="signup">
		insert into member(
		memberID
		,memberPW
		,memberNick
		,memberName
		,memberDob
		,memberGender
		,memberEmail
		,memberMobile
		,memberDelNy
		,memberAd
		,memberGrade
		,memberRegdate
		)
		values(
		#{memberID}
		,#{memberPW}
		,#{memberNick}
		,#{memberName}
		,#{memberDob}
		,#{memberGender}
		,#{memberEmail}
		,#{memberMobile}
		,0
		,#{memberAd}
		,1
		,now()
		)
		<selectKey resultType="String" keyProperty="memberSeq" order="AFTER"> 
			select last_insert_id()
		</selectKey>
	</insert>
	
	<select id="selectOne" resultMap="resultMapObj">
		SELECT
			a.*
		from member a
		WHERE 1=1
		AND memberSeq = #{memberSeq}
	</select>
	
	<select id="selectOneIdCheck" resultType="Integer">
			SELECT 
				COUNT(*)
			from 
				member
			WHERE
				memberID = #{memberID}
				
		</select>
		
		<sql id='basic'>
		FROM member
			WHERE 1=1
			<choose>
				<when test = "shOption == 1">AND memberName LIKE CONCAT('%',#{shValue},'%')</when>
				<when test = "shOption == 2">AND memberID LIKE CONCAT('%', #{shValue},'%')</when>
				<when test = "shOption == 3">AND memberNick LIKE CONCAT('%',#{shValue}, '%')</when>
			</choose>
   		</sql>
   		
   		<select id="selectOneId" resultMap="resultMapObj">
   			select
   				a.memberSeq
   				,a.memberID
   			from
   				member a
   			WHERE 1=1
   				and a.memberID = #{memberID}
   		</select>    
   		
    	<select id="selectOneLogin" resultMap="resultMapObj">
    		select
    			a.memberSeq
    			,a.memberID
    			,a.memberName
    			,a.memberNick
    			,a.memberGrade
    		from
    			member a
    		where 1=1
    			and a.memberID = #{memberID}
    			<if test="memberPW != null and !memberPW.equals('')">and a.memberPW = #{memberPW}</if>
    	</select>
</mapper>		
